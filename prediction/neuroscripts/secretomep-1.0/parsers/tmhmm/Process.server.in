#!/usr/freeware/bin/gawk -f
BEGIN {
  # read lengths
  fname=fileid".Features/allprot_len/feature.out";
  i=1;
  while ( getline < fname > 0 ){
    lenid[$1]=$2;
    i++
  }
  close(fname);
  gotit=1;
}

/\/\/\-\/\//{
   if (gotit==0)
     printf "*" >> "/dev/stderr";

   ident=$2;
   cntH=1;
   cntI=1;
   cntO=1;
   
   gotit=0;
}
($3=="outside") {
   for (i=$4;i<=$5;i++){
      setOpos[cntO]=i;
      setOval[cntO]=1;
      cntO++;
   }
}
($3=="inside") {
   for (i=$4;i<=$5;i++){
      setIpos[cntI]=i;
      setIval[cntI]=1;
      cntI++;
   }
}
($3=="TMhelix") {
   for (i=$4;i<=$5;i++){
      setHpos[cntH]=i;
      setHval[cntH]=1;
      cntH++;
   }
}

#($0=="</pre><P>") {
(ident!="") && ($1==ident) && ($NF==lenid[ident]) {
# change by KR, to parse TMHMM 2.0c, 2004, Aug 30

   if (lenid[ident]=="") {
     print "Error '"ident"' does not have a length entry\n" >> "/dev/stderr";
     next;
   }
   gotit=1;
   printf "." >> "/dev/stderr";


   fn=fileid".Features/tmhmm_vect";
   beginarray(ident,fn);
   makearrays(lenid[ident],setOval,setOpos,cntO,0,fn);
   makearrays(lenid[ident],setIval,setIpos,cntI,0,fn);
   makearrays(lenid[ident],setHval,setHpos,cntH,1,fn);
   endarray(fn);

   fn=fileid".Features/tmhmm";
   beginarray(ident,fn);
   makearrays(lenid[ident],setIval,setIpos,cntI,0,fn);
   makearrays(lenid[ident],setOval,setOpos,cntO,0,fn);
   makearrays(lenid[ident],setHval,setHpos,cntH,1,fn);
   endarray(fn);

}
{
   # un-caught line
}

